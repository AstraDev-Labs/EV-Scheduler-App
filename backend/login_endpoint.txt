class LoginRequest(BaseModel):
    email: str
    password: str

@app.post("/api/login")
def login(request: LoginRequest):
    """Login with email and password"""
    try:
        from database import db
        
        # Get user from database
        user = db.get_user_by_email(request.email)
        
        if not user:
            raise HTTPException(
                status_code=401, 
                detail="Invalid email or password"
            )
        
        # Check if user is verified
        if not user.get("is_verified", False):
            raise HTTPException(
                status_code=403,
                detail="Account not verified. Please check your email."
            )
        
        # Verify password
        if not db.verify_password(request.password, user["password_hash"]):
            raise HTTPException(
                status_code=401,
                detail="Invalid email or password"
            )
        
        # Return user data (excluding password)
        return {
            "status": "success",
            "message": "Login successful",
            "user": {
                "id": user["id"],
                "email": user["email"],
                "full_name": user["full_name"],
                "created_at": user.get("created_at")
            }
        }
        
    except HTTPException:
        raise
    except Exception as e:
        print(f"Login error: {e}")
        raise HTTPException(status_code=500, detail=str(e))
